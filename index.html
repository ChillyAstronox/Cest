<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Crypto Exchange Simulations Terminal</title>
<link rel="icon" href="https://imgs.search.brave.com/hB03-eLwHTKa2O97uGFuuzkzItHKUcwtIX8cJxC9X4A/rs:fit:860:0:0:0/g:ce/aHR0cHM6Ly9jZG4t/aWNvbnMtcG5nLmZs/YXRpY29uLmNvbS8x/MjgvMTgzODQvMTgz/ODQwMDUucG5n" type="image/x-icon">
<style>
  :root{
    --bg:#0b1020; --card:#0f1724; --muted:#9aa4bf; --accent:#7ee787; --danger:#ff6b6b;
    --glass: rgba(255,255,255,0.03);
    color-scheme: dark;
  }
  body{font-family:Inter,Segoe UI,Roboto,Arial;background:linear-gradient(180deg,#05060a 0%, #071028 100%);color:#e6eef8;margin:0;padding:24px;}
  .container{max-width:1100px;margin:0 auto;}
  header{display:flex;align-items:center;justify-content:space-between;margin-bottom:18px}
  h1{font-size:20px;margin:0}
  .top-row{display:flex;gap:12px;align-items:center}
  .card{background:var(--card);border-radius:12px;padding:14px;box-shadow:0 6px 20px rgba(2,8,23,0.6);min-width:0}
  .balance{font-size:20px;font-weight:600}
  .muted{color:var(--muted);font-size:13px}
  .controls{display:flex;gap:8px}
  .btn{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:8px 10px;border-radius:8px;color:inherit;cursor:pointer}
  .btn.primary{background:linear-gradient(90deg,#2bff9b,#23d37b);color:#04210f;border:none}
  .btn.danger{border-color:rgba(255,107,107,0.25);color:var(--danger)}
  main{display:grid;grid-template-columns:1fr 380px;gap:16px;margin-top:18px}
  .panel{padding:12px;border-radius:10px}
  .buy-sell{display:flex;flex-direction:column;gap:8px}
  label{font-size:13px;color:var(--muted)}
  input[type="number"], select, input[type="text"]{padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:var(--glass);color:inherit}
  /* make small inputs for amount / fiat */
  .small-input{width:140px;max-width:42%;padding:6px;border-radius:8px}
  table{width:100%;border-collapse:collapse;color:#dfe9ff}
  th,td{padding:8px;text-align:left;border-bottom:1px dashed rgba(255,255,255,0.02);font-size:13px}
  th{color:var(--muted);font-weight:600}
  .small{font-size:12px}
  .pos{color:#9ef79a}
  .neg{color:#ff9b9b}
  .center{text-align:center}
  footer{margin-top:18px;color:var(--muted);font-size:13px}
  .admin-btn{background:transparent;border:1px dashed rgba(255,255,255,0.06);padding:6px 8px;border-radius:8px;cursor:pointer}
  .alert{padding:8px;border-radius:8px;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.02);color:var(--muted)}
  .flex{display:flex;gap:8px;align-items:center}
  /* modal */
  .modal-bg{position:fixed;inset:0;background:rgba(2,6,20,0.7);display:none;align-items:center;justify-content:center;z-index:30}
  .modal{background:var(--card);padding:18px;border-radius:12px;min-width:320px;max-width:680px}
  .right{margin-left:auto}
  .small-muted{font-size:12px;color:var(--muted)}
  .danger{color:var(--danger);font-weight:600}
  .thin{font-weight:400}
  .nowrap{white-space:nowrap}

  /* responsive tweak: make input stack on very small screens */
  @media (max-width:720px){
    .small-input{width:48%}
  }
</style>
</head>
<body>
<div class="container">
  <header>
    <div>
      <h1>Crypto Exchange Simulations Terminal</h1>
      <div class="muted small">Prices from CoinGecko (public API)</div>
    </div>
    <div class="top-row">
      <div class="card" style="padding:10px 14px">
        <div class="muted small">Balance (<span id="currency-label">USD</span>)</div>
        <div class="balance" id="balance-display">$10,000.00</div>
        <div class="muted small">Portfolio value: <span id="portfolio-display">$0.00</span></div>
      </div>

      <div style="display:flex;flex-direction:column;gap:8px">
        <button class="admin-btn" id="open-admin">Admin Panel</button>
        <button class="btn" id="reload-btn">Reload</button>
      </div>
    </div>
  </header>

  <main>
    <section class="card panel" style="overflow-x:hidden;">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
        <strong>Trade</strong>
      </div>

      <div class="buy-sell">
        <label for="coin">Select coin</label>
        <select id="coin" style="width:100%">
          <option value="bitcoin">Bitcoin (BTC)</option>
          <option value="ethereum">Ethereum (ETH)</option>
          <option value="dogecoin">Dogecoin (DOGE)</option>
          <option value="monero">Monero (XMR)</option>
          <option value="binancecoin">Binance Coin (BNB)</option>
          <option value="solana">Solana (SOL)</option>
          <option value="ripple">Ripple (XRP)</option>
          <option value="cardano">Cardano (ADA)</option>
          <option value="polkadot">Polkadot (DOT)</option>
          <option value="litecoin">Litecoin (LTC)</option>
        </select>

        <div style="display:flex;gap:8px;align-items:center;margin-top:8px">
          <div style="display:flex;flex-direction:column">
            <label for="amount" class="small muted">Amount (coin)</label>
            <input class="large-input" type="number" id="amount" step="any" min="0" placeholder="e.g. 0.01" />
          </div>

          <div style="display:flex;flex-direction:column">
            <label for="fiat-amount" class="small muted">Or spend / receive (<span id="currency-label-2">USD</span>)</label>
            <input class="large-input" type="number" id="fiat-amount" step="any" min="0" placeholder="e.g. 200" />
          </div>

          <div style="display:flex;flex-direction:column;gap:8px;margin-left:auto">
            <div style="display:flex;gap:8px">
              <button class="btn primary" id="buy-btn">Buy</button>
              <button class="btn" id="sell-btn">Sell</button>
            </div>
            <div id="price-note" class="muted small" style="text-align:right"></div>
          </div>
        </div>
      </div>

      <hr style="border:none;border-top:1px dashed rgba(255,255,255,0.04);margin:12px 0" />

      <div>
        <strong>Portfolio</strong>
        <div class="muted small">Holdings and unrealized P/L</div>
        <table style="margin-top:8px">
          <thead><tr><th>Coin</th><th>Holdings</th><th>Avg Cost</th><th>Current</th><th>Value</th><th>P/L</th></tr></thead>
          <tbody id="portfolio-table">
            <tr><td colspan="6" class="center small-muted">Loading...</td></tr>
          </tbody>
        </table>
      </div>

      <hr style="border:none;border-top:1px dashed rgba(255,255,255,0.04);margin:12px 0" />

      <div>
        <strong>Trade History</strong>
        <div class="muted small">Saved locally via cookies/localStorage</div>
        <table style="margin-top:8px">
          <thead><tr><th>Time</th><th>Action</th><th>Coin</th><th>Amount</th><th>Price (<span id="currency-label-3">USD</span>)</th></tr></thead>
          <tbody id="history-table">
            <tr><td colspan="5" class="center small-muted">No trades yet</td></tr>
          </tbody>
        </table>
      </div>

    </section>

    <aside class="card panel">
      <div style="display:flex;align-items:center;gap:8px;justify-content:space-between">
        <strong>Market</strong>
        <div class="muted small" id="last-updated">—</div>
      </div>
--input test
        <table style="margin-top:12px">
          <thead><tr><th>Coin</th><th>Price (<span id="currency-label-4">USD</span>)</th><th>24h %</th></tr></thead>
          <tbody id="market-table">
            <tr><td colspan="3" class="center small-muted">Loading prices…</td></tr>
          </tbody>
        </table>
      </div>

      <hr style="border:none;border-top:1px dashed rgba(255,255,255,0.04);margin:12px 0" />

      <div class="alert small-muted">
        Data persistence:
        <ul style="margin:8px 0 0 18px;padding:0">
          <li>Balance & settings: <strong>cookies</strong></li>
          <li>Trades & holdings: <strong>localStorage</strong> (reliable for history)</li>
        </ul>
      </div>
    </aside>
  </main>

  <footer></footer>
</div>

<!-- ADMIN MODAL -->
<div class="modal-bg" id="modal-bg">
  <div class="modal">
    <div style="display:flex;align-items:center;gap:8px">
      <strong id="modal-title">Admin Panel</strong>
      <button class="btn right" id="close-modal">Close</button>
    </div>
    <div style="margin-top:12px" id="modal-body">
      <div id="admin-panel">
        <label>Currency label (displayed alongside amounts)</label>
        <input type="text" id="admin-currency" />

        <label style="margin-top:8px">Fiat conversion rate (1 fake USD = X displayed currency)</label>
        <input type="number" step="any" id="admin-conversion" />

        <label style="margin-top:8px">Starting balance</label>
        <input type="number" id="admin-start-balance" />

        <div style="display:flex;gap:8px;margin-top:12px">
          <button class="btn primary" id="admin-save">Save</button>
          <button class="btn danger" id="admin-reset-all">Reset all data</button>
        </div>

        <div class="small-muted" style="margin-top:8px">Changing starting balance will update your balance immediately.</div>
      </div>
    </div>
  </div>
</div>

<script>
/* ======================
   Persistence helpers
   ====================== */
const COOKIE_PREFIX = 'paper_sim_';
function setCookie(name, value, days = 3650){
  const key = COOKIE_PREFIX + name;
  const expires = new Date(Date.now() + days*24*60*60*1000).toUTCString();
  document.cookie = key + '=' + encodeURIComponent(value) + '; expires=' + expires + '; path=/; SameSite=Lax';
}
function getCookie(name){
  const key = COOKIE_PREFIX + name + '=';
  const c = document.cookie.split('; ').find(s => s.startsWith(key));
  return c ? decodeURIComponent(c.substring(key.length)) : null;
}
function deleteCookie(name){
  document.cookie = COOKIE_PREFIX + name + '=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/';
}
function saveLocal(name, obj){
  try { localStorage.setItem(COOKIE_PREFIX + name, JSON.stringify(obj)); return true; }
  catch(e){ console.warn('local save failed', e); return false; }
}
function loadLocal(name){
  try { const v = localStorage.getItem(COOKIE_PREFIX + name); return v ? JSON.parse(v) : null; }
  catch(e){ console.warn('local load failed', e); return null; }
}
function removeLocal(name){ localStorage.removeItem(COOKIE_PREFIX + name); }

/* ======================
   Default state & coins
   ====================== */
const DEFAULT_STATE = {
  balance: 10000.0,
  currencyLabel: 'USD',
  conversionRate: 1.0,
  selectedCurrencyCode: 'usd'
};
const COIN_LIST = {
  bitcoin:{symbol:'BTC',id:'bitcoin'},
  ethereum:{symbol:'ETH',id:'ethereum'},
  dogecoin:{symbol:'DOGE',id:'dogecoin'},
  monero:{symbol:'XMR',id:'monero'},
  binancecoin:{symbol:'BNB',id:'binancecoin'},
  solana:{symbol:'SOL',id:'solana'},
  ripple:{symbol:'XRP',id:'ripple'},
  cardano:{symbol:'ADA',id:'cardano'},
  polkadot:{symbol:'DOT',id:'polkadot'},
  litecoin:{symbol:'LTC',id:'litecoin'}
};

let state = loadState();

function loadState(){
  const raw = getCookie('small_state');
  let small = {};
  if (raw){
    try { small = JSON.parse(raw); } catch(e){ small = {}; }
  }
  const s = {
    balance: typeof small.balance === 'number' ? small.balance : DEFAULT_STATE.balance,
    currencyLabel: small.currencyLabel || DEFAULT_STATE.currencyLabel,
    conversionRate: typeof small.conversionRate === 'number' ? small.conversionRate : DEFAULT_STATE.conversionRate,
    selectedCurrencyCode: small.selectedCurrencyCode || DEFAULT_STATE.selectedCurrencyCode
  };
  s.trades = loadLocal('trades') || [];
  s.holdings = loadLocal('holdings') || (function(){ const h={}; Object.keys(COIN_LIST).forEach(k=>h[k]={amount:0,cost:0}); return h; })();
  return s;
}
function saveSmallState(){
  const small = {
    balance: state.balance,
    currencyLabel: state.currencyLabel,
    conversionRate: state.conversionRate,
    selectedCurrencyCode: state.selectedCurrencyCode
  };
  setCookie('small_state', JSON.stringify(small), 3650);
}
function saveLargeState(){
  saveLocal('trades', state.trades || []);
  saveLocal('holdings', state.holdings || {});
}
function saveAll(){ saveSmallState(); saveLargeState(); }

/* ======================
   CoinGecko fetchers (prices only)
   ====================== */
let marketData = {};
const COINGECKO_SIMPLE = 'https://api.coingecko.com/api/v3/simple/price';

async function fetchMarketData(){
  const ids = Object.keys(COIN_LIST).map(k=>COIN_LIST[k].id).join(',');
  const vs = state.selectedCurrencyCode || 'usd';
  const url = `${COINGECKO_SIMPLE}?ids=${encodeURIComponent(ids)}&vs_currencies=${encodeURIComponent(vs)}&include_24hr_change=true`;
  try {
    const r = await fetch(url);
    if (!r.ok) throw new Error('fetch market failed');
    const j = await r.json();
    marketData = {};
    for (const k of Object.keys(COIN_LIST)){
      const id = COIN_LIST[k].id;
      marketData[k] = {
        price: (j[id] && j[id][vs]) || 0,
        change_24h: (j[id] && j[id][vs + '_24h_change']) || 0
      };
    }
    document.getElementById('last-updated').textContent = new Date().toLocaleString();
  } catch(e){
    console.warn('fetchMarketData error', e);
  }
}

/* ======================
   UI updates
   ====================== */
function formatCurrencyVal(n){
  const code = (state.selectedCurrencyCode || 'usd').toUpperCase();
  try {
    return new Intl.NumberFormat(undefined,{style:'currency',currency:code}).format(n * (state.conversionRate || 1));
  } catch(e){
    return (state.currencyLabel || 'USD') + ' ' + (n * (state.conversionRate || 1)).toFixed(2);
  }
}
function updateMarketTable(){
  const tbody = document.getElementById('market-table');
  tbody.innerHTML = '';
  for (const coinKey of Object.keys(COIN_LIST)){
    const m = marketData[coinKey] || {price:0, change_24h:0};
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${COIN_LIST[coinKey].symbol}</td>
      <td>${formatCurrencyVal(m.price)}</td>
      <td class="${m.change_24h>=0 ? 'pos' : 'neg'}">${m.change_24h ? m.change_24h.toFixed(2) + '%' : '—'}</td>`;
    tbody.appendChild(tr);
  }
  ['currency-label','currency-label-2','currency-label-3','currency-label-4'].forEach(id=>{
    const el = document.getElementById(id); if (el) el.textContent = (state.currencyLabel || state.selectedCurrencyCode.toUpperCase() || 'USD');
  });
  document.getElementById('balance-display').textContent = formatCurrencyVal(state.balance);
  updatePortfolioTable();
  updateHistoryTable();
}

function updatePortfolioTable(){
  const tbody = document.getElementById('portfolio-table'); tbody.innerHTML = '';
  let has = false;
  for (const coinKey of Object.keys(state.holdings || {})){
    const h = state.holdings[coinKey];
    if (!h || (h.amount||0) <= 0) continue;
    has = true;
    const price = (marketData[coinKey] && marketData[coinKey].price) || 0;
    const avgCost = h.cost || 0;
    const value = price * h.amount;
    const pl = (price - avgCost) * h.amount;
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${COIN_LIST[coinKey].symbol}</td>
      <td>${(h.amount||0).toLocaleString()}</td>
      <td>${formatCurrencyVal(avgCost)}</td>
      <td>${formatCurrencyVal(price)}</td>
      <td>${formatCurrencyVal(value)}</td>
      <td class="${pl>=0?'pos':'neg'}">${formatCurrencyVal(pl)}</td>`;
    tbody.appendChild(tr);
  }
  if (!has) tbody.innerHTML = '<tr><td colspan="6" class="center small-muted">No holdings</td></tr>';
  let total = 0;
  for (const coinKey of Object.keys(state.holdings || {})){
    const h = state.holdings[coinKey];
    total += ((marketData[coinKey] && marketData[coinKey].price) || 0) * (h.amount||0);
  }
  document.getElementById('portfolio-display').textContent = formatCurrencyVal(total);
}

function updateHistoryTable(){
  const tbody = document.getElementById('history-table'); tbody.innerHTML = '';
  if (!state.trades || state.trades.length === 0){ tbody.innerHTML = '<tr><td colspan="5" class="center small-muted">No trades yet</td></tr>'; return; }
  for (const t of state.trades.slice().reverse()){
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${new Date(t.time).toLocaleString()}</td>
      <td>${t.action}</td>
      <td>${COIN_LIST[t.coin].symbol}</td>
      <td>${(t.amount||0).toFixed(6)}</td>
      <td>${formatCurrencyVal(t.price)}</td>`;
    tbody.appendChild(tr);
  }
}

/* ======================
   Trading logic (buy/sell)
   ====================== */
function buyCoin(){
  const coin = document.getElementById('coin').value;
  let amount = parseFloat(document.getElementById('amount').value) || 0;
  let fiat = parseFloat(document.getElementById('fiat-amount').value) || 0;
  const price = (marketData[coin] && marketData[coin].price) || 0;
  if (!price) return alert('Price not available');
  if (!amount && fiat) amount = fiat / price;
  else if (amount && !fiat) fiat = amount * price;
  if (!amount || amount <= 0) return alert('Enter amount or fiat');
  const cost = fiat * (state.conversionRate || 1);
  if (cost > state.balance) return alert('Insufficient balance');
  const h = state.holdings[coin] || {amount:0,cost:0};
  const newAmount = (h.amount || 0) + amount;
  const newCost = ((h.cost || 0) * (h.amount || 0) + fiat) / newAmount;
  state.holdings[coin] = { amount: newAmount, cost: newCost };
  state.balance -= cost;
  state.trades = state.trades || [];
  state.trades.push({ time: Date.now(), action: 'Buy', coin, amount, price });
  saveAll();
  updatePortfolioTable(); updateHistoryTable(); updateMarketTable();
  document.getElementById('amount').value = ''; document.getElementById('fiat-amount').value = '';
}

function sellCoin(){
  const coin = document.getElementById('coin').value;
  let amount = parseFloat(document.getElementById('amount').value) || 0;
  let fiat = parseFloat(document.getElementById('fiat-amount').value) || 0;
  const price = (marketData[coin] && marketData[coin].price) || 0;
  if (!price) return alert('Price not available');
  if (!amount && fiat) amount = fiat / price;
  else if (amount && !fiat) fiat = amount * price;
  if (!amount || amount <= 0) return alert('Enter amount or fiat');
  const h = state.holdings[coin] || {amount:0,cost:0};
  if (amount > (h.amount || 0)) return alert('Not enough holdings');
  const gain = fiat * (state.conversionRate || 1);
  const remaining = (h.amount || 0) - amount;
  state.holdings[coin] = { amount: remaining, cost: remaining > 0 ? h.cost : 0 };
  state.balance += gain;
  state.trades = state.trades || [];
  state.trades.push({ time: Date.now(), action: 'Sell', coin, amount, price });
  saveAll();
  updatePortfolioTable(); updateHistoryTable(); updateMarketTable();
  document.getElementById('amount').value = ''; document.getElementById('fiat-amount').value = '';
}

/* ======================
   Admin modal logic
   ====================== */
const modalBg = document.getElementById('modal-bg');
document.getElementById('open-admin').addEventListener('click', ()=>{
  document.getElementById('admin-currency').value = state.currencyLabel || state.selectedCurrencyCode.toUpperCase();
  document.getElementById('admin-conversion').value = state.conversionRate || 1;
  document.getElementById('admin-start-balance').value = state.balance || 10000;
  modalBg.style.display = 'flex';
});
document.getElementById('close-modal').addEventListener('click', ()=> modalBg.style.display = 'none');
document.getElementById('admin-save').addEventListener('click', ()=>{
  const label = document.getElementById('admin-currency').value.trim() || state.currencyLabel || 'USD';
  const conv = parseFloat(document.getElementById('admin-conversion').value) || 1;
  const startBal = parseFloat(document.getElementById('admin-start-balance').value) || state.balance;
  state.currencyLabel = label;
  state.conversionRate = conv;
  state.balance = startBal;
  saveAll();
  updateMarketTable();
  modalBg.style.display = 'none';
});
document.getElementById('admin-reset-all').addEventListener('click', ()=>{
  if (!confirm('This will clear ALL trades, holdings, balance and settings. Continue?')) return;
  deleteCookie('small_state');
  removeLocal('trades'); removeLocal('holdings');
  location.reload();
});

/* ======================
   Currency selector handling
   ====================== */
document.getElementById('currency-select').addEventListener('change', async (e)=>{
  state.selectedCurrencyCode = e.target.value;
  state.currencyLabel = e.target.value.toUpperCase();
  saveSmallState();
  await fetchMarketData();
  updateMarketTable();
});

/* ======================
   Reload button wiring
   ====================== */
document.getElementById('reload-btn').addEventListener('click', async ()=>{
  await fetchMarketData();
  updateMarketTable();
});

/* ======================
   Wire buy/sell buttons
   ====================== */
document.getElementById('buy-btn').addEventListener('click', buyCoin);
document.getElementById('sell-btn').addEventListener('click', sellCoin);

/* ======================
   Init on load
   ====================== */
(async function init(){
  // set currency select to saved state
  const sel = document.getElementById('currency-select'); if (sel) sel.value = state.selectedCurrencyCode || 'usd';
  await fetchMarketData();
  updateMarketTable();
  // refresh periodically
  setInterval(async ()=>{ await fetchMarketData(); updateMarketTable(); }, 10000);
})();
</script>
</body>
</html>


